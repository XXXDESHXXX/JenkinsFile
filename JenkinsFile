pipeline {
    agent any

    stages {
        stage('Pull Images from Docker Hub') {
            steps {
                script {
                    // Загрузка Nginx образа с Docker Hub
                    sh 'docker pull xxxdeshxxx/custom-nginx'
                    
                    // Загрузка Apache образа с Docker Hub
                    sh 'docker pull xxxdeshxxx/custom-apache'
                }
            }
        }
        
        stage('Create Docker Network') {
            steps {
                script {
                    // Создаем сеть если она не создана
                    sh '''
                    docker network inspect my_network >/dev/null 2>&1 || \
                    docker network create my_network
                    '''
                }
            }
        }
        
        stage('Run Nginx Container') {
            steps {
                script {
                    // Запускаем контейнер на основе Nginx образа
                    sh '''
                    docker run -d --name custom-nginx --network my_network -p 80:80 xxxdeshxxx/custom-nginx
                    '''
                }
            }
        }

        stage('Run Apache Container') {
            steps {
                script {
                    // Запускаем контейнер на основе Apache образа
                    sh '''
                    docker run -d --name custom-apache --network my_network -p 8083:8083 xxxdeshxxx/custom-apache
                    '''
                }
            }
        }
    }
    
    post {
        always {
            echo 'Pipeline finished!'
        }
        success {
            echo 'Containers deployed successfully!'
        }
        failure {
            echo 'Pipeline failed!'
        }
    }
}

